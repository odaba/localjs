(function(){window.attachEvent("onload",function(){var D=document,v=YAHOO.util.Event,w=localJS.COM.createObject,g=LOCALJS.UI,j=LOCALJS.FILE,k=LOCALJS.LOCALIZATION,q=k.get,r=g.msgBox,m=new YAHOO.widget.Button("btnADO"),x=new YAHOO.widget.Button("btnOpenExcel");var i=j.buildPath(j.getParentFolder(j.urlToPath(D.URL)),"sample data.xls");var s=function(){var F=w("ADODB.Connection");F.Provider="Microsoft.Jet.OLEDB.4.0";F.ConnectionString="Data Source="+i+";Extended Properties=Excel 8.0;";F.Open();return F};var c=function(F){if(F){try{F.Close()}catch(G){}}};var p=function(Q){var O,I,G=[];try{var N=1,P=3,H=1,K="SELECT * FROM [employee data$]";if(Q){Q.match(/\bsort=([^&=]+)/i);var M=RegExp.$1;Q.match(/\bdir=([^&=]+)/i);var F=RegExp.$1;K+=" order by "+M+" "+F}O=s(),I=w("ADODB.Recordset"),I.Open(K,O,N,P,H);I.MoveFirst();while(!I.EOF){var J=I.Fields;G.push({name:J.Item("Name").Value,age:J.Item("Age").Value,gender:J.Item("Gender").Value,start_day:new Date(J.Item("Start_Day").Value),id:J.Item("ID").Value});I.MoveNext()}}catch(L){alert(L.name+"\n"+L.description)}c(I);c(O);return{items:G}};var y=function(F,H,P){var N,I,J=false;try{var M=1,O=3,G=1,K="SELECT * FROM [employee data$] where id = "+F;N=s();I=w("ADODB.Recordset");I.Open(K,N,M,O,G);I.MoveFirst();if(!I.EOF){I.Update(H,P);J=true}}catch(L){alert(L.name+"\n"+L.description)}c(I);c(N);return J};var E=function(F,G){return y(F.getRecord().getData("id"),F.getColumn().key,G)?G:undefined};var t,z=new YAHOO.util.FunctionDataSource(p);z.responseType=YAHOO.util.DataSource.TYPE_JSON;z.responseSchema={resultsList:"items"};var e=function(){var F={success:t.onDataReturnInitializeTable,scope:t};z.sendRequest(null,F)};var h=function(G,F,H,I){G.innerHTML=F.getData(H.key)+q("years_old")};var o=function(G,F,H,I){G.innerHTML=F.getData(H.key)?q("Male"):q("Female")};var l=function(H,G,I,J){var F=G.getData(I.key);H.innerHTML=q("formatDate")(F)};var b=function(F,H,G){F=YAHOO.lang.trim(F);if(F==H){G.cancel();return undefined}if(0==F.length){alert(q("Name should not be empty."));return undefined}return E(G,F)};var C=function(F,H,G){F=YAHOO.lang.trim(F);if(F==H){G.cancel();return undefined}if(F.search(/[^\d]/)>=0||1*F<=0){alert(q("Please fill with valid non-negative integer."));return undefined}return E(G,1*F)};var f=function(F,H,G){F=YAHOO.lang.trim(F);if(q("Male")==F){F=1}else{if(q("Female")==F){F=0}else{return undefined}}if(F==H){G.cancel();return undefined}return E(G,F)};var B=function(F,I,G){var J=new Date(F);if(0==J-new Date(I)){G.cancel();return undefined}var H=J.getMonth()+1;return E(G,H+"/"+J.getDate()+"/"+J.getFullYear())?F:undefined};var u={validator:B},d;if("en"!=k.getLang()){var n=["1","2","3","4","5","6","7","8","9","10","11","12"],a=["日","一","二","三","四","五","六"];d={show_week_header:true,MY_LABEL_YEAR_SUFFIX:"年",MY_LABEL_MONTH_SUFFIX:"月",MONTHS_SHORT:n,MONTHS_LONG:n,WEEKDAYS_1CHAR:a,WEEKDAYS_SHORT:a,WEEKDAYS_MEDIUM:a,WEEKDAYS_LONG:a,MY_LABEL_YEAR_POSITION:1,MY_LABEL_MONTH_POSITION:2,navigator:{strings:{month:q("Please choose month"),year:q("Please input year"),submit:q("Goto"),cancel:q("Cancel"),invalidYear:q("Please input valid year")}}};u.LABEL_SAVE=q("Save");u.LABEL_CANCEL=q("Cancel")}else{d={show_week_header:true,navigator:true}}u.calendarOptions=d;var A=[{key:"id",label:"ID",resizeable:true,sortable:true},{key:"name",label:q("Name"),resizeable:true,sortable:true,editor:new YAHOO.widget.TextboxCellEditor({validator:b,LABEL_SAVE:q("Save"),LABEL_CANCEL:q("Cancel")})},{key:"age",label:q("Age"),resizeable:true,formatter:h,sortable:true,editor:new YAHOO.widget.TextboxCellEditor({validator:C,LABEL_SAVE:q("Save"),LABEL_CANCEL:q("Cancel")})},{key:"gender",label:q("Gender"),resizeable:true,sortable:true,formatter:o,editor:new YAHOO.widget.RadioCellEditor({radioOptions:[q("Male"),q("Female")],validator:f,disableBtns:true})},{key:"start_day",label:q("Start Day"),resizeable:true,sortable:true,formatter:l,editor:new YAHOO.widget.DateCellEditor(u)}];m.on("click",function(){try{if(t){e()}else{r(q("Open_with_ADO_1st")+i+q("Open_with_ADO_2nd"));t=new YAHOO.widget.ScrollingDataTable(D.getElementById("dataTable"),A,z,{width:"740px",height:"280px",dynamicData:true});var H=function(I){var J=I.target;if(YAHOO.util.Dom.hasClass(J,"yui-dt-editable")){this.highlightCell(J)}};var F=function(J){var N=J.editor,Q=N.getRecord(),M=N.getColumn();if(M){if("start_day"==M.key){var L=N.calendar,I=Q.getData(M.key);L.select(I);L.cfg.setProperty("pagedate",I);L.render()}else{if("gender"==M.key){var P=Q.getData(M.key),O=N.radios;for(var K=0;K<O.length;++K){O[K].checked=K!=P}}}}};t.subscribe("cellMouseoverEvent",H);t.subscribe("cellMouseoutEvent",t.onEventUnhighlightCell);t.subscribe("cellClickEvent",t.onEventShowCellEditor);t.subscribe("editorShowEvent",F);x.setStyle("visibility","visible");x.set("label",q("Open_with_Excel_1st")+i+q("Open_with_Excel_2nd"));x.set("disabled",false);x.focus();x.on("click",function(){j.exec(i);r(q("excel_changes"))});r(q("table_reminder"))}}catch(G){alert(G.name+"\n"+G.description)}});m.set("disabled",false);m.focus()})})();